# /opt/local/share/dnscrypt-proxy/dnscrypt-proxy.toml

# listener config
listen_addresses = ['127.0.0.1:54', '[::1]:54']

# server selection
ipv4_servers = true
ipv6_servers = false
dnscrypt_servers = true
doh_servers = false
odoh_servers = false

# server requirements
require_dnssec = true
require_nolog = true
require_nofilter = true

# load balancing server selection
lb_strategy = 'p2'
lb_estimator = true

# disable resolvers whose operators also run anonymizing relays
# prevents same operator from seeing both relay and resolver traffic
disabled_server_names = [
    'cs-de', 'cs-nl', 'cs-fr', 'cs-austria', 'cs-barcelona',
    'scaleway-fr', 'scaleway-ams',
    'dnscrypt.uk-ipv4', 'dnscrypt.uk-ipv6', 'v.dnscrypt.uk-ipv4', 'v.dnscrypt.uk-ipv6'
]

# connection settings
force_tcp = false
timeout = 5000
keepalive = 30
cert_refresh_delay = 240
cert_ignore_timestamp = false

# privacy hardening
dnscrypt_ephemeral_keys = true
tls_disable_session_tickets = true

# fallbacks
bootstrap_resolvers = ['9.9.9.9:53', '1.1.1.1:53']
ignore_system_dns = true
netprobe_timeout = 60
netprobe_address = '9.9.9.9:53'

# query filtering
block_ipv6 = false
block_unqualified = true
block_undelegated = true
reject_ttl = 10

# cache
cache = true
cache_size = 4096
cache_min_ttl = 2400
cache_max_ttl = 86400
cache_neg_min_ttl = 60
cache_neg_max_ttl = 600

# resolver sources (replace existing config)
[sources.public-resolvers]
urls = [
    'https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/public-resolvers.md',
    'https://download.dnscrypt.info/resolvers-list/v3/public-resolvers.md',
]
cache_file = 'public-resolvers.md'
minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'
refresh_delay = 73
prefix = ''

[sources.relays]
urls = [
    'https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/relays.md',
    'https://download.dnscrypt.info/resolvers-list/v3/relays.md',
]
cache_file = 'relays.md'
minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'
refresh_delay = 73
prefix = ''

# anonymized dns (relay thru 3p servers)
[anonymized_dns]
routes = [
    { server_name='*', via=[
        'anon-cs-de',
        'anon-cs-nl', 
        'anon-cs-fr',
        'anon-scaleway-ams',
        'anon-kama',
        'anon-ibksturm',
        'anon-meganerd',
        'anon-inconnu'
    ]}
]
skip_incompatible = true
direct_cert_fallback = false
